#
# PiAP OpenSSL Beta configuration file v0.2.4
#

# This definition stops the following lines choking if HOME isn't
# defined. Imporvements welcome.
HOME					= .
RANDFILE				= $ENV::HOME/.rnd

# set these if you wish
COUNTRY					= US
# STATE					= California


# Extra OBJECT IDENTIFIER info:
#oid_file				= $ENV::HOME/.oid
oid_section				= basic_oids

# To use this configuration file with the "-extfile" option of the
# "openssl x509" utility, name here the section containing the
# X.509v3 extensions to use:
# extensions		= 
# (Alternatively, use a configuration file that has only
# X.509v3 extensions in its main [= default] section.)

####################################################################
[ basic_oids ]

# Global defaults
# ISO is the first 1
iso_oid					= 1

# OSI Registration Authorities (registration-authority) 1.1
iso_RA					= ${iso_oid}.1

# ISO Member body 1.2
iso_member				= ${iso_oid}.2

# ISO Member body US 1.2.840
iso_country_us			= ${iso_member}.840

# ISO identified organization
iso_identified_org		= ${iso_oid}.3

# DoD registered OID
DoD_oid					= ${iso_oid}.2

# "Amazon unique identification scheme" registered OID
Amazon_oid				= ${iso_oid}.187

# EXAMPLE Policies used by the TSA examples. read RFC 3161
tsa_policy1				= ${iso_member}.3.4.1
tsa_policy2				= ${iso_member}.3.4.5.6
tsa_policy3				= ${iso_member}.3.4.5.7

# CN = github.com
# O = "GitHub, Inc."
# L = San Francisco
# ST = California
# C = US
postal_zipcode					= 2.5.4.17
postal_address					= 2.5.4.9
# phone_number??				= 2.5.4.5
# state = (1 3 6 1 4 1 311 60 2 1 2)
# country = (1 3 6 1 4 1 311 60 2 1 3)
oid_subj_org_type = 2.5.4.15
# set this to Private Organization

# PKI-Me-Harder OIDs
# 1.3.159.1.17.1

# 1.3.6.1.4.1.34697.2.1
# 1.3.6.1.4.1.34697.2.2
# 1.3.6.1.4.1.34697.2.3
# 1.3.6.1.4.1.34697.2.4

# 1.2.40.0.17.1.22

# 2.16.578.1.26.1.3.3

# 1.3.6.1.4.1.17326.10.14.2.1.2
# 1.3.6.1.4.1.17326.10.8.12.1.2

# 1.3.6.1.4.1.6449.1.2.1.5.1

# 2.16.840.1.114412.2.1
# 2.16.840.1.114412.1.3.0.2

# uber-PKI-Me-Harder
# 2.16.528.1.1001.1.1.1.12.6.1.1.1

# 2.16.792.3.0.4.1.1.4

# 2.16.840.1.114028.10.1.2

# 0.4.0.2042.1.4
# 0.4.0.2042.1.5

# 1.3.6.1.4.1.13177.10.1.3.10

# 1.3.6.1.4.1.14370.1.6

# 1.3.6.1.4.1.4146.1.1

# 2.16.840.1.114413.1.7.23.3

# 1.3.6.1.4.1.14777.6.1.1

# 2.16.792.1.2.1.1.5.7.1.9

# 1.3.6.1.4.1.782.1.2.1.8.1

# 1.3.6.1.4.1.22234.2.5.2.3.1

# 1.3.6.1.4.1.8024.0.2.100.1.2

# 1.2.392.200091.100.721.1

# 2.16.840.1.114414.1.7.23.3

# 1.3.6.1.4.1.23223.2
# 1.3.6.1.4.1.23223.1.1.1

# 2.16.756.1.83.21.0

# 2.16.756.1.89.1.2.1.1

# 1.3.6.1.4.1.7879.13.24.1

# 2.16.840.1.113733.1.7.48.1

# 2.16.840.1.114404.1.1.2.4.1

# 2.16.840.1.113733.1.7.23.6

# 1.3.6.1.4.1.6334.1.100.1

# 1.3.6.1.4.1.6334.1.100.1

# 1.3.6.1.4.1.36305.2

## policyies oid
# 2.16.840.1.114412.2.1 = Certification Practice Statement pointer (URL?)
# 2.23.140.1.1
#1.3.6.1.4.1.11129.2.5.1
#2.23.140.1.2.2

####################################################################
[ ca ]
default_ca	= CA_default		# The default ca section

####################################################################
[ CA_default ]

dir							= /etc/ssl/PiAPCA
crl_dir						= $dir/crl
crlnumber					= $dir/crlnumber
crl							= $dir/PiAP_CA.crl
crl_extensions				= crl_v3_ext
default_crl_days			= 30
database					= $dir/index.txt
unique_subject				= no
certificate					= $dir/PiAP_CA.pem
private_key					= $dir/private/PiAP_CA.key
RANDFILE					= $dir/private/.rand
serial						= $dir/serial
certs						= $dir/certs
new_certs_dir				= $dir/certs
x509_extensions				= usr_cert
name_opt					= ca_default
cert_opt					= ca_default
default_days				= 365
# CWE- weak default - see https://github.com/openssl/openssl/issues/439
default_md					= sha512
preserve					= no
policy						= policy_match

####################################################################
[ policy_match ]
countryName					= match
stateOrProvinceName			= match
organizationName			= match
organizationalUnitName		= optional
commonName					= supplied
emailAddress				= optional

####################################################################
[ policy_anything ]
countryName					= optional
stateOrProvinceName			= optional
localityName				= optional
organizationName			= optional
organizationalUnitName		= optional
commonName					= supplied
emailAddress				= optional

####################################################################
[ req ]
default_bits				= 4096
default_keyfile 			= pocket.PiAP.local.key
distinguished_name			= req_distinguished_name
attributes					= req_attributes
x509_extensions				= usr_cert
req_extensions				= v3_req
string_mask					= utf8only
# utf8						= yes
# input_password			= secret
# output_password			= secret

####################################################################
[ req_distinguished_name ]
countryName					= Country Name (2 letter code)
countryName_min				= 2
countryName_max				= 2
stateOrProvinceName			= State or Province Name (full name)
localityName				= Locality Name (eg, domain)
0.organizationName			= Organization Name (eg, group, company)
organizationalUnitName		= Organizational Unit Name (eg, section)
commonName					= Common Name (eg, YOUR name)
commonName_min				= 3
commonName_max				= 256
emailAddress				= Email Address
emailAddress_max			= 256

0.organizationName_default	= Pocket WiFi Access Point Project
organizationalUnitName_default	= Pocket PiAP
localityName_default		= PiAP.local
stateOrProvinceName_default	= $ENV::STATE
countryName_default			= $ENV::COUNTRY

####################################################################
[ req_attributes ]
challengePassword			= A challenge password
challengePassword_min		= 8
challengePassword_max		= 128
unstructuredName			= An optional unstructured name

####################################################################
[ usr_cert ]

# This goes against PKIX guidelines. Should peer-review this
basicConstraints			= critical,CA:FALSE
nsCertType					= client
extendedKeyUsage			= critical,clientAuth
keyUsage					= digitalSignature
nsComment					= "Pocket PiAP Issued User Certificate"
subjectKeyIdentifier		= hash
authorityKeyIdentifier		= keyid:always,issuer
#subjectAltName				= @usr_subject_alt_names
# Copy subject details
issuerAltName				= issuer:copy
#nsCaRevocationUrl			= https://pocket.PiAP.local/ca/crls/CA.crl
#nsBaseUrl					= https://pocket.PiAP.local/ca
#nsRevocationUrl			= https://pocket.PiAP.local/ca/crls/CA.crl
#nsCaPolicyUrl				= https://pocket.PiAP.local/ca/policy.html

####################################################################
[ server_cert ]

# This goes against PKIX guidelines. Should peer-review this
basicConstraints			= critical,CA:FALSE
nsCertType					= server
extendedKeyUsage			= critical,serverAuth
keyUsage					= digitalSignature,keyEncipherment
nsComment					= "Pocket PiAP Issued Server Certificate"
subjectKeyIdentifier		= hash
authorityKeyIdentifier		= keyid:always,issuer
#subjectAltName				= @server_subject_alt_names
issuerAltName				= issuer:copy
nsCaRevocationUrl			= http://www.domain.dom/ca-crl.pem
#nsCaRevocationUrl			= https://pocket.PiAP.local/ca/crls/CA.crl
#nsBaseUrl					= https://pocket.PiAP.local/ca
#nsRevocationUrl			= https://pocket.PiAP.local/ca/crls/CA.crl
#nsCaPolicyUrl				= https://pocket.PiAP.local/ca/policy.html
#nsSslServerName			= pocket.PiAP.local

####################################################################
[ PiAP_server_cert ]

# This goes against PKIX guidelines. Should peer-review this
basicConstraints			= critical,CA:FALSE
nsCertType					= server
extendedKeyUsage			= critical,serverAuth
keyUsage					= digitalSignature,keyEncipherment
nsComment					= "Pocket PiAP SSL Server Certificate"
subjectKeyIdentifier		= hash
authorityKeyIdentifier		= keyid:always,issuer
subjectAltName				= @piap_srv_subj_alt_names
issuerAltName				= issuer:copy
nsCaRevocationUrl			= http://www.domain.dom/ca-crl.pem
#nsCaRevocationUrl			= https://pocket.PiAP.local/ca/crls/CA.crl
#nsBaseUrl					= https://pocket.PiAP.local/ca
#nsRevocationUrl			= https://pocket.PiAP.local/ca/crls/CA.crl
#nsCaPolicyUrl				= https://pocket.PiAP.local/ca/policy.html
#nsSslServerName			= pocket.PiAP.local

####################################################################
[ piap_srv_subj_alt_names ]
DNS.1						= Pocket.PiAP.local.
DNS.3						= HOST-1.PiAP.local
# RFC 2818 vs RFC6125 [section 1.7.2] - should peer review
IP.1						= 10.0.40.1

####################################################################
[ sign_cert ]

# This goes against PKIX guidelines. Should peer-review this
basicConstraints			= critical,CA:FALSE
nsCertType					= email, objsign
keyUsage					= nonRepudiation, digitalSignature, keyEncipherment
nsComment					= "Pocket PiAP Issued Signing Certificate"
subjectKeyIdentifier=hash
authorityKeyIdentifier		= keyid:always,issuer
subjectAltName				= email:copy
issuerAltName				= issuer:copy

####################################################################
[ v3_req ]
basicConstraints			= critical,CA:FALSE
keyUsage					= nonRepudiation, digitalSignature, keyEncipherment

####################################################################
[ v3_ca ]
subjectKeyIdentifier		= hash
authorityKeyIdentifier		= keyid:always,issuer
basicConstraints			= critical,CA:true
keyUsage					= cRLSign, keyCertSign
#nsCertType = sslCA, emailCA
# DER hex encode
# obj=DER:02:03
# You can even override a supported extension:
# basicConstraints= critical, DER:30:03:01:01:FF

####################################################################
[ crl_ext ]
issuerAltName				= issuer:copy
authorityKeyIdentifier		= keyid:always

####################################################################
[ tsa ]
default_tsa = tsa_config1	# the default TSA section

####################################################################
[ tsa_config1 ]

# These are used by the TSA reply generation only.
dir							= /etc/ssl/TSA_CA
serial						= $dir/tsaserial
crypto_device				= builtin
signer_cert					= $dir/tsacert.pem
certs						= $dir/cacert.pem
signer_key					= $dir/private/tsa.key
default_policy				= tsa_policy1
other_policies				= tsa_policy2, tsa_policy3
digests						= sha1, sha256
accuracy					= secs:1, millisecs:500, microsecs:100
clock_precision_digits		= 0
ordering					= yes
tsa_name					= yes
ess_cert_id_chain			= no
